package com.example.demo.utils;

import com.google.common.collect.Lists;
import com.vanke.core.util.CollectionUtil;
import com.vanke.core.util.DataUtil;
import util.model.Poi;

import java.util.ArrayList;
import java.util.List;

/**
 * Created by ltj on 2019/7/29
 */
public class PostGisUtil {


    /**
     *  [[[114.12326,22.569046],[114.1231,22.569298],[114.122787,22.569298]...]]
     *  转化为
     * POLYGON((113.832525706904 22.6479137415534,113.892393405798 22.6567056893499,113.892420929213 22.6567093651081...))
     * @param lngLatList
     * @return
     */
    public static String lngLatListToPolygonStr(List<List<Double>> lngLatList) {
        if(CollectionUtil.isEmpty(lngLatList)){
            return null;
        }

        StringBuffer sb = new StringBuffer();
        sb.append("POLYGON((");
        lngLatList.forEach(l->{
            String temp = l.get(0) + " " + l.get(1)+",";
            sb.append(temp);
        });
        sb.deleteCharAt(sb.length() - 1);
        sb.append("))");

        return sb.toString();
    }

    public static List<Poi> polygonStrToList(String polygonStr) {
        if(DataUtil.isEmpty(polygonStr)){
            return null;
        }
        List<Poi> list = Lists.newArrayList();
        try {
            String[] points = polygonStr.replace("POLYGON((", "").replace("))", "").split(",");
            for (int i = 0; i < points.length; i++) {
                String[] lngLat = points[i].split(" ");
                Double lnt = Double.valueOf(lngLat[0]);
                Double lat = Double.valueOf(lngLat[1]);
                Poi poi = new Poi(lat, lnt);
                list.add(poi);
            }
        }catch (Exception e){
            System.out.println(e.getMessage());
        }
        return list;
    }

    public static List<String> busLineToPolygonStrList(List<List<List<List<Double>>>> busLine){
        if(CollectionUtil.isEmpty(busLine)){
            return null;
        }
        List<String> polygonList = new ArrayList<>();
        busLine.forEach(p1->{
            p1.forEach(p2->{
                String polygon = lngLatListToPolygonStr(p2);
                polygonList.add(polygon);
            });
        });
        return polygonList;
    }

    public static void main(String[] args) {
        String polygonStr = "POLYGON((113.680178806959 22.9252197641847,113.699171140078 22.9607828447775,113.699005465166 22.9837507603627,113.701256954045 22.9907505096284,113.733251269562 22.9797222292529,113.9481164396 22.8888751967814,113.948184558612 22.8888450873357,113.949176558493 22.8883872874482,113.949230410664 22.8883615832878,113.952930410419 22.8865362832902,113.952935686488 22.8865336720831,113.955140686549 22.8854388715984,113.955173627378 22.8854221855406,113.955653627031 22.8851741857952,113.955721523216 22.8851376527344,113.956324523144 22.8848000526343,113.976163018424 22.8736737153014,113.97619305999 22.873656568637,113.976505059989 22.8734753687345,113.976621148423 22.8734032568964,113.97694914826 22.8731857567589,113.977017469319 22.8731386576512,113.977483470124 22.8728048571867,113.977658917305 22.8726657911988,113.97819291675 22.8721984917725,113.978315752085 22.8720827796793,113.978490752062 22.8719053794124,113.978502698299 22.8718931791431,114.040049698293 22.8085692788654,114.040093130375 22.8085233475203,114.040665130672 22.8079015472644,114.040724950937 22.8078339027353,114.041533950473 22.8068821034492,114.041670873579 22.8067040962905,114.041960874362 22.8062863962737,114.042025050711 22.8061887611549,114.04249805004 22.8054277611348,114.042530696918 22.8053735901668,114.0429116974 22.8047212903031,114.04295747216 22.8046391097027,114.04320947209 22.8041641093818,114.043304813681 22.8039610800807,114.075576226299 22.7255169315042,114.080488603743 22.7256732455098,114.08066388895 22.7257565759126,114.080792888603 22.7258061753221,114.081001489789 22.72587514753,114.081131489488 22.7259113479403,114.081330631528 22.725957382517,114.08147563192 22.7259841823139,114.081759652367 22.7260185964111,114.081889652066 22.7260261965817,114.081957761014 22.7260291671939,114.082155761152 22.726034867097,114.082412690237 22.7260279083638,114.082572690421 22.7260146082901,114.082836712591 22.7259771622997,114.083035712775 22.725937062429,114.083229146237 22.7258892879671,114.08359685606 22.725781387335,114.083633284458 22.72577331063,114.084990293027 22.7258164912381,114.090489800682 22.727742488038,114.090566695778 22.7278043856845,114.091497070423 22.728607645295,114.091657458988 22.7287463171135,114.091808641428 22.7288663306989,114.091960641243 22.7289769302234,114.092002637677 22.7290067750195,114.092200637815 22.7291441752403,114.092243320336 22.7291730916244,114.092465320681 22.7293198915593,114.092565085746 22.7293822575326,114.092717085561 22.7294719577121,114.09278963364 22.7295130180947,114.09291963334 22.7295835177486,114.093008142604 22.7296290684791,114.093145142626 22.729695868322,114.093229558097 22.7297349375754,114.093390558327 22.7298055379532,114.093513986788 22.7298595636163,114.093658386652 22.7299170406878,114.093833386629 22.7299799410703,114.093933243841 22.7300132748026,114.094131243979 22.7300743747423,114.094240464304 22.7301051515375,114.094576463611 22.7301909513573,114.094717880618 22.7302223587393,114.094969880548 22.7302700587806,114.094972498409 22.730270552736,114.096483498841 22.7305547528917,114.096501638597 22.7305580895643,114.100849597746 22.7313398689729,114.102314638667 22.7316032888409,114.102351433111 22.7315952617011,114.102385153153 22.7316009935403,114.200940717397 22.7535943397791,114.204890040643 22.7779765586715,114.204959669879 22.7787802794552,114.204987036057 22.7789868702524,114.205147036241 22.7798814699584,114.205171357172 22.7799995286442,114.205346357149 22.7807491288581,114.20534704265 22.7807520565156,114.205476577211 22.7813036533199,114.205476577211 22.7813036533199,114.205476577211 22.7813036533199,114.20572104191 22.7823446569337,114.205727916527 22.7823731166536,114.206292916501 22.7846486163681,114.206303102051 22.7846881366817,114.206670431571 22.7860628469124,114.206909875378 22.7870171497015,114.207022670425 22.7874794885317,114.207038714876 22.7875414942251,114.207071482038 22.7876612327027,114.20721707789 22.7882415046664,114.207438514557 22.7891806648823,114.207458181854 22.7892580447138,114.207632742018 22.78989813317,114.208129674616 22.7918786569931,114.208556540548 22.7936301571716,114.20856108963 22.7936484953206,114.208782089929 22.7945239952249,114.208824094068 22.7946699297147,114.209060094159 22.7953985298595,114.209089915411 22.7954847318845,114.209410914926 22.7963563323285,114.209484935718 22.7965340291857,114.209896935832 22.7974171292608,114.210024512141 22.7976535132816,114.210626512023 22.7986282129043,114.210696408498 22.7987346777355,114.211330408956 22.7996444777828,114.211504321981 22.7998642112441,114.212488321493 22.8009628113644,114.212679370488 22.8011525120786,114.213785371129 22.8021291119688,114.213980858906 22.802283727078,114.214973675752 22.8029850632474,114.214973675752 22.8029850632474,114.215384858901 22.8032755273094,114.215600699203 22.8034107472645,114.216752145167 22.804046248029,114.217880902111 22.8047041013204,114.21796796805 22.8047523532789,114.220064519553 22.8058556968488,114.22158221237 22.8066859755734,114.221609718192 22.8067007814907,114.222190207507 22.8070081874896,114.22683352785 22.8095868959967,114.229759000278 22.8085785002976,114.24627256107 22.7956517874564,114.274389022519 22.7681422653375,114.275825124686 22.7692915802371,114.276009974776 22.7694399718245,114.276046775452 22.7694689038205,114.277898970105 22.7708948308585,114.279769999786 22.7694302004434,114.279992654484 22.7651835313943,114.273293853983 22.7534732840103,114.273435089561 22.7486766500863,114.27345180014 22.7485264783216,114.273465920839 22.7482719001281,114.273465920839 22.7476295601598,114.273472923083 22.7473917503585,114.273462391357 22.7470939034967,114.269580844027 22.7084568486844,114.269755361611 22.7070798674986,114.279052699383 22.6622420480101,114.27913781556 22.6619124166091,114.279179458982 22.6617161809913,114.288270950404 22.6072924859116,114.289299000349 22.5876846001642,114.264755064 22.5708452434166,114.259164272135 22.5684643920183,114.249044679764 22.5613782921391,114.246891009313 22.5585888887078,114.240706999728 22.5543460996928,114.240623000351 22.5542889001127,114.240620222345 22.5542874450096,114.232375667137 22.5512128160409,114.217651647976 22.5522821405228,114.200388275908 22.552150353418,114.200382195573 22.5521490218858,114.19914583519 22.5518167969723,114.198597054503 22.551652541678,114.19854414068 22.5516373909285,114.195698140737 22.5508591904749,114.195411332654 22.5508000769016,114.195221332885 22.5507733769293,114.194985869427 22.5507525444117,114.19477986982 22.5507449442411,114.194526274222 22.5507495711456,114.191153274258 22.5509974719655,114.191149232726 22.5509977725777,114.190211232638 22.5510683720563,114.189059832072 22.551156171687,114.188658728297 22.5511776823491,114.188559008455 22.5511852055528,114.188147008341 22.5512253054235,114.187983680453 22.5512471276861,114.187647680247 22.5513043281655,114.187217960712 22.5514211786428,114.186748127551 22.5515993046407,114.164100921283 22.5551081757335,114.15235441171 22.5461283507351,114.147418483712 22.542282771353,114.147377883465 22.5422359030845,114.147263825257 22.5421135205142,114.147133825558 22.5419838202887,114.147108504022 22.5419589436959,114.146970503954 22.5418254438347,114.146961942162 22.5418172039177,114.144744961333 22.53969456377,114.143682186141 22.5391169874325,114.129458021405 22.5357571468435,114.118896579829 22.5273959099756,114.118797740255 22.5272581906409,114.118774089884 22.527235660825,114.118774089714 22.5272356607593,114.11877408964 22.5272356605925,114.118759740057 22.5272219908974,114.118360155028 22.526917120621,114.118322155075 22.5268942202844,114.117844543156 22.5266762869319,114.11779154341 22.5266590873978,114.117546589523 22.5265942567355,114.1175005892 22.5265847562973,114.117035000065 22.5265371793244,114.116982000319 22.5265371793244,114.116427608065 22.5266049361765,114.116373607373 22.526618336075,114.116288621786 22.526641157608,114.116242622362 22.5266544576818,114.116048542464 22.526724647806,114.088213502656 22.5279600388293,114.07670223621 22.5187055174193,114.062608045101 22.5051428870238,114.060332715063 22.5024072808612,114.06041964206 22.5019939540671,114.060094853523 22.5002623364362,114.058640754776 22.4992675580441,114.057427037061 22.4994952073787,114.055753835294 22.4989513901922,114.055047717594 22.499130566004,114.054538700601 22.4988736918246,114.052865241369 22.499424619599,114.052714911498 22.4997225104147,114.048677636177 22.5007469601386,114.048621243851 22.5007310220368,114.048522250023 22.500786389033,114.048330167087 22.5008351296551,114.046586759694 22.5012775154427,114.046542886321 22.5012900806828,114.04654045547 22.5012897792165,114.046323530898 22.5013496542797,114.046256934503 22.5013691208317,114.04524993483 22.5016800209596,114.045210903232 22.5016924529971,114.044870093452 22.50180435474,114.044837913177 22.501832011789,114.043423147533 22.5022842022507,114.043423137053 22.5022842007934,114.043423126033 22.5022842091227,114.04330281531 22.5023226630969,114.040877396383 22.5030978807515,113.982158603534 22.4578997612087,113.974837999574 22.4551696999218,113.974631999967 22.4551162999773,113.971891385495 22.45526100923,113.968600389116 22.460968526742,113.960251614002 22.4700452303624,113.931121855234 22.480786060947,113.904740713797 22.4664397569593,113.904686044375 22.4664109710781,113.902023956181 22.4650545781562,113.897967843632 22.4591643019453,113.895270999557 22.4593067000442,113.883232000157 22.4648227997325,113.879325999895 22.4724082997033,113.875243377465 22.4803966914643,113.874149848283 22.4854820247588,113.872157056286 22.4911579386869,113.872122956576 22.4912630719426,113.872075395517 22.4914226662479,113.87202925643 22.4915670915386,113.872029834186 22.491573996351,113.871979362047 22.4917485512577,113.870750362028 22.4970586504394,113.870733934871 22.4971355889438,113.868066520669 22.5107653518264,113.868020040556 22.510997061097,113.867983653574 22.5116482948179,113.871093812341 22.547582024977,113.860037943213 22.5559220231614,113.851727685632 22.5589860032554,113.850578286294 22.5599157440791,113.776344286694 22.6773397442966,113.776261752368 22.6774812004914,113.739805902842 22.7454046918098,113.687752000355 22.8472575995586,113.687056999781 22.8486213998578,113.683463999564 22.8556746999275,113.682631999867 22.8574085002022,113.681869999801 22.859088899633,113.68087799992 22.8615416997897,113.679893000362 22.8642750002911,113.677192999957 22.8728217999861,113.676247000399 22.8759155002002,113.675925999985 22.8770618003618,113.675636000101 22.8782309999607,113.675261999941 22.879907599756,113.675078999596 22.8808136001676,113.674629000428 22.8833159997337,113.674545000152 22.8839474002524,113.674453999552 22.8846435996224,113.674370000175 22.8853951001038,113.674332000222 22.8866138001868,113.674278000429 22.8885116997552,113.67418699983 22.8917198000288,113.674087999761 22.8960895995554,113.673972999854 22.9014492001206,113.674109999877 22.9037246998351,113.674239999576 22.9048747996324,113.674278000429 22.9051285001802,113.67456099999 22.9068717999936,113.674629000428 22.9072838001073,113.674881000358 22.9083861998633,113.675049000011 22.9091014999343,113.675178999711 22.9096316997432,113.675598000148 22.9109782996089,113.680178806959 22.9252197641847))";

        List<Poi> polygonList = PostGisUtil.polygonStrToList(polygonStr);

        System.out.println(polygonList);
    }

}
